@page "/reports"
@using CapstoneDraft.Models;
@using CapstoneDraft.Services;
@using System.Text;

@inject ReportService ReportService

<div class="fullsize-container">
    <div class="social-media-container">
        <div class="social-media-card">
            <h2>Safety Net Reports</h2>
            <select @onchange="ProcessReportSelection">
                <option value="0">Select a report:</option>
                <option value="1">Total Posts Per User Report</option>
                <option value="2">Total Comments Per User Report</option>
                <option value="3">Total Number of Posts Per Category</option>
                <option value="4">Latest User Activity Report</option>
            </select>
        </div>
        @if (reportDisplayTable != null)
        {
            @reportDisplayTable
        }
    </div>
</div>

@code {
    private int selectedReport;
    private RenderFragment reportDisplayTable;

    private async Task ProcessReportSelection(ChangeEventArgs args)
    {
        selectedReport = Convert.ToInt32(args.Value);
        await GenerateReportsAsync();
    }

    private async Task GenerateReportsAsync()
    {

        try
        {
            switch (selectedReport)
            {
                case 1:
                    var totalPostPerUser = await ReportService.GetTotalPostsPerUserAsync();
                    reportDisplayTable = CreateReportDisplayTable(totalPostPerUser, new[] { "Username", "Total Posts", "Latest Post Timestamp" },
                    item => new object[] { item.Key, item.Value.TotalPosts, item.Value.LatestPostTimestamp });
                    break;
                case 2:
                    var total
            }
        }
        catch
        {

        }
    }

    private RenderFragment CreateReportDisplayTable<TItem>(IEnumerable<TItem> query, IEnumerable<string> columnTitles, Func<TItem, IEnumerable<object>> queryResults)
    {
        return builder =>
        {
            builder.OpenComponent(0, typeof(ReportTableFormat<TItem>));
            builder.AddAttribute(1, "Query", query);
            builder.AddAttribute(2, "Column Titles", columnTitles);
            builder.AddAttribute(3, "Query Results", queryResults);
            builder.CloseComponent();
        };
    }
}
