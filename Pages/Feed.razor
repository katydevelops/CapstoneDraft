@page "/feed"
@using CapstoneDraft.Models
@using CapstoneDraft.Services
@using Microsoft.AspNetCore.Identity
@inject PostService PostService
@inject UserManager<UserModel> userManager;
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

@if (feedPosts == null)
{
    <h1>There are currently no posts in the feed!</h1>
}
@foreach (var feedPost in feedPosts)
{
    <div class="fullsize-container">
    <div class="social-media-container">
            <h4>Name: @feedPost.AuthorName</h4>
            <h5>Subject:  @feedPost.PostSubject</h5>
            <div class="social-media-card">
                <p>@feedPost.PostMessageBody</p>
                <p>Posted by @(feedPost.AuthorName) on @feedPost.PostCreatedTimestamp.ToString("MM/dd/yy")</p>
                    <img class="feed-photo" src="@($"/{feedPost.PostPhoto}")" asp-append-version="true" alt="Post image" />
        </div>
    </div>
</div>
}


@code {
    public List<PostModel> feedPosts;
    private string commentText;
    private int editedCommentId;
    private string currentUserId;
    private string FeedErrorMessage;


    protected override async Task OnInitializedAsync()
    {
        var userAuthenticationState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var loggedInUser = userAuthenticationState.User;
        if (loggedInUser.Identity.IsAuthenticated)
        {
            var loggedInUserId = UserManager.GetUserId(loggedInUser);
            currentUserId = loggedInUserId;
            feedPosts = await PostService.FetchFeedPostAsync();
        }

    }
}
