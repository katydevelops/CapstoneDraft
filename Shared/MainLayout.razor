@inherits LayoutComponentBase

@using CapstoneDraft.Models;

@inject NavigationManager NavigationManager
@inject SignInManager<UserModel> SignInManager



<PageTitle>Safety Net</PageTitle>

<nav class="navbar">
    <a href="/feed" class="nav-link">Feed</a>
    <a href="/userprofile" class="nav-link">Profile</a>
    <a href="/reports" class="nav-link">Reports</a>
    <a href="/search" class="nav-link">Search</a>
    <a href="/" class="nav-link">Logout</a>
    <button class="logout-button" @onclick="BeginLogout">Logout</button>

</nav>

<div>
    @Body
</div>

<footer class="border-top-0 footer">
    <div class="container">
        &copy; 2024 - Safety Net Workplace Safety Application
    </div>
</footer>

@code {
    private TaskCompletionSource<bool> _logoutCompletionSource;

    protected override void OnInitialized()
    {
        _logoutCompletionSource = new TaskCompletionSource<bool>();
        _logoutCompletionSource.Task.ContinueWith(async _ =>
        {
            await Logout();
        }, TaskScheduler.Default);
    }

    private void BeginLogout()
    {
        _logoutCompletionSource.SetResult(true);
    }

    private async Task Logout()
    {
        await SignInManager.SignOutAsync();
        NavigationManager.NavigateTo("/login", forceLoad: true);
    }
}